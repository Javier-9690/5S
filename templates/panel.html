{% extends "base.html" %}
{% block content %}
  <h1>Panel de ingreso</h1>
  <div class="toolbar">
    <a class="btn" href="{{ url_for('registros') }}">Registros</a>
    <a class="btn" href="{{ url_for('dashboard') }}">Dashboard</a>
  </div>

  {% if tab=='censo' %}
    <h2>Censo</h2>
    <div class="toolbar">
      <a class="btn" href="{{ url_for('template_xlsx', entity='censo') }}">Descargar plantilla Excel</a>
      <form method="post" action="{{ url_for('import_xlsx', entity='censo') }}" enctype="multipart/form-data" style="display:inline-flex; gap:8px;">
        <input type="file" name="file" accept=".xlsx" required>
        <button class="btn" type="submit">Importar Excel</button>
      </form>
    </div>
    <form method="post" action="{{ url_for('panel', tab='censo') }}" style="margin-top:10px;">
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px;">
        <div><label>Fecha</label><input type="date" name="fecha" required></div>
        <div><label>Censo día</label><input type="number" name="censo_dia" min="0" placeholder="0"></div>
        <div><label>Censo noche</label><input type="number" name="censo_noche" min="0" placeholder="0"></div>
      </div>
      <div style="margin-top:8px; max-width:320px;">
        <label>Total (opcional)</label><input type="number" name="total" min="0" placeholder="(auto)">
      </div>
      <div class="toolbar"><button class="btn" type="submit">Guardar</button></div>
    </form>

  {% elif tab=='eventos' %}
    <h2>Eventos de seguridad</h2>
    <div class="toolbar">
      <a class="btn" href="{{ url_for('template_xlsx', entity='eventos') }}">Descargar plantilla Excel</a>
      <form method="post" action="{{ url_for('import_xlsx', entity='eventos') }}" enctype="multipart/form-data" style="display:inline-flex; gap:8px;">
        <input type="file" name="file" accept=".xlsx" required>
        <button class="btn" type="submit">Importar Excel</button>
      </form>
    </div>
    <form method="post" action="{{ url_for('panel', tab='eventos') }}" style="margin-top:10px;">
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px;">
        <div><label>Fecha</label><input type="date" name="fecha" required></div>
        <div><label>Horario</label><input type="text" name="horario" required placeholder="Mañana/Tarde/Noche o HH:MM"></div>
        <div><label>Nombre del afectado</label><input type="text" name="nombre_afectado" placeholder="Opcional"></div>
      </div>
      <div style="display:grid; grid-template-columns: repeat(2, minmax(240px,1fr)); gap:12px; margin-top:8px;">
        <div><label>Qué ocurrió</label><textarea name="que_ocurrio" required></textarea></div>
        <div><label>Acción</label><textarea name="accion"></textarea></div>
      </div>
      <div class="toolbar"><button class="btn" type="submit">Guardar</button></div>
    </form>

  {% elif tab=='duplicidades' %}
    <h2>Duplicidades</h2>
    <div class="toolbar">
      <a class="btn" href="{{ url_for('template_xlsx', entity='duplicidades') }}">Descargar plantilla Excel</a>
      <form method="post" action="{{ url_for('import_xlsx', entity='duplicidades') }}" enctype="multipart/form-data" style="display:inline-flex; gap:8px;">
        <input type="file" name="file" accept=".xlsx" required>
        <button class="btn" type="submit">Importar Excel</button>
      </form>
    </div>
    <form method="post" action="{{ url_for('panel', tab='duplicidades') }}" style="margin-top:10px;">
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px;">
        <div>
          <label>Semana</label>
          <select name="semana" required>
            <option value="">-- Elegir --</option>
            {% for num, r in week_map.items()|sort %}
              <option value="{{ num }}">{{ num }} ({{ r[0] }} → {{ r[1] }})</option>
            {% endfor %}
          </select>
        </div>
        <div><label>Fecha</label><input type="date" name="fecha" required></div>
        <div><label>ID</label><input type="text" name="id"></div>
      </div>
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px; margin-top:8px;">
        <div><label>Empresa contratista</label><input type="text" name="empresa_contratista"></div>
        <div><label>TIPO DE RIESGO (Psicosocial)</label><input type="text" name="tipo_riesgo"></div>
        <div><label>PABELLON</label><input type="text" name="pabellon"></div>
      </div>
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px; margin-top:8px;">
        <div><label>Habitación</label><input type="text" name="habitacion"></div>
        <div><label>Ingresar Contacto</label><input type="text" name="ingresar_contacto"></div>
        <div><label>Nombre usuario</label><input type="text" name="nombre_usuario"></div>
      </div>
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px; margin-top:8px;">
        <div><label>Responsable (Toma Requerimiento)</label><input type="text" name="responsable"></div>
        <div><label>Estatus</label><input type="text" name="estatus" placeholder="Abierto/Cerrado"></div>
        <div><label>Notificación Usuario</label><input type="text" name="notificacion_usuario"></div>
      </div>
      <div style="margin-top:8px;"><label>Descripción Problema</label><textarea name="descripcion_problema"></textarea></div>
      <div style="margin-top:8px;"><label>Plan de Acción</label><textarea name="plan_accion"></textarea></div>
      <div style="margin-top:8px; max-width:260px;"><label>Fecha de Cierre</label><input type="date" name="fecha_cierre"></div>
      <div class="toolbar"><button class="btn" type="submit">Guardar</button></div>
    </form>

  {% elif tab=='encuesta' %}
    <h2>Encuesta de satisfacción</h2>
    <div class="toolbar">
      <a class="btn" href="{{ url_for('template_xlsx', entity='encuesta') }}">Descargar plantilla Excel</a>
      <form method="post" action="{{ url_for('import_xlsx', entity='encuesta') }}" enctype="multipart/form-data" style="display:inline-flex; gap:8px;">
        <input type="file" name="file" accept=".xlsx" required>
        <button class="btn" type="submit">Importar Excel</button>
      </form>
    </div>
    <form method="post" action="{{ url_for('panel', tab='encuesta') }}" style="margin-top:10px;">
      <div style="max-width:280px;">
        <label>FECHA_HORA</label><input type="datetime-local" name="fecha_hora" required>
      </div>
      <div style="display:grid; grid-template-columns: repeat(2, minmax(240px,1fr)); gap:12px; margin-top:8px;">
        <div><label>Q1_RESPUESTA</label><input type="text" name="q1_respuesta"></div>
        <div><label>Q1_PUNTAJE</label><input type="number" name="q1_puntaje" min="0" max="10"></div>
        <div><label>Q2_RESPUESTA</label><input type="text" name="q2_respuesta"></div>
        <div><label>Q2_PUNTAJE</label><input type="number" name="q2_puntaje" min="0" max="10"></div>
        <div><label>Q3_RESPUESTA</label><input type="text" name="q3_respuesta"></div>
        <div><label>Q3_PUNTAJE</label><input type="number" name="q3_puntaje" min="0" max="10"></div>
        <div><label>Q4_RESPUESTA</label><input type="text" name="q4_respuesta"></div>
        <div><label>Q4_PUNTAJE</label><input type="number" name="q4_puntaje" min="0" max="10"></div>
        <div><label>Q5_RESPUESTA</label><input type="text" name="q5_respuesta"></div>
        <div><label>Q5_PUNTAJE</label><input type="number" name="q5_puntaje" min="0" max="10"></div>
      </div>
      <div style="margin-top:8px;"><label>COMENTARIOS</label><textarea name="comentarios"></textarea></div>
      <div class="toolbar"><button class="btn" type="submit">Guardar</button></div>
    </form>

  {% elif tab=='atencion' %}
    <h2>Atención al público</h2>
    <div class="toolbar">
      <a class="btn" href="{{ url_for('template_xlsx', entity='atencion') }}">Descargar plantilla Excel</a>
      <form method="post" action="{{ url_for('import_xlsx', entity='atencion') }}" enctype="multipart/form-data" style="display:inline-flex; gap:8px;">
        <input type="file" name="file" accept=".xlsx" required>
        <button class="btn" type="submit">Importar Excel</button>
      </form>
    </div>
    <form method="post" action="{{ url_for('panel', tab='atencion') }}" style="margin-top:10px;">
      <div style="display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:12px;">
        <div><label>FECHA</label><input type="date" name="fecha" required></div>
        <div><label>TIEMPO PROMEDIO (mm:ss)</label><input type="text" name="tiempo_promedio" placeholder="mm:ss" pattern="[0-9]{2}:[0-9]{2}" title="mm:ss, ej: 03:54"></div>
        <div><label>CANTIDAD</label><input type="number" name="cantidad" min="0" placeholder="0"></div>
      </div>
      <div class="toolbar"><button class="btn" type="submit">Guardar</button></div>
    </form>
  {% endif %}
{% endblock %}

