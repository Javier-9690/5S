{% extends "base.html" %}
{% block title %}Sistema de Gestión 5400 - Panel{% endblock %}

{% block content %}
<div class="content-container">
  <h1 class="page-title">Panel de Gestión</h1>
  
  <div class="row">
    <!-- Sidebar Navigation -->
    <div class="col-lg-3">
      <div class="sidebar">
        <h5 class="mb-3">Módulos del Sistema</h5>
        
        <div class="list-group">
          <div class="list-group-item fw-bold text-muted small">MÓDULOS PRINCIPALES</div>
          <a href="{{ url_for('panel', tab='censo') }}" class="list-group-item list-group-item-action {% if tab=='censo' %}active{% endif %}">
            <i class="fas fa-users me-2"></i>Censo
          </a>
          <a href="{{ url_for('panel', tab='eventos') }}" class="list-group-item list-group-item-action {% if tab=='eventos' %}active{% endif %}">
            <i class="fas fa-shield-alt me-2"></i>Eventos de Seguridad
          </a>
          <a href="{{ url_for('panel', tab='duplicidades') }}" class="list-group-item list-group-item-action {% if tab=='duplicidades' %}active{% endif %}">
            <i class="fas fa-copy me-2"></i>Duplicidades
          </a>
          <a href="{{ url_for('panel', tab='encuesta') }}" class="list-group-item list-group-item-action {% if tab=='encuesta' %}active{% endif %}">
            <i class="fas fa-poll me-2"></i>Encuestas
          </a>
          <a href="{{ url_for('panel', tab='atencion') }}" class="list-group-item list-group-item-action {% if tab=='atencion' %}active{% endif %}">
            <i class="fas fa-headset me-2"></i>Atención al Público
          </a>
          
          <div class="list-group-item fw-bold text-muted small mt-3">MÓDULOS OPERACIONALES</div>
          <a href="{{ url_for('panel', tab='robos') }}" class="list-group-item list-group-item-action {% if tab=='robos' %}active{% endif %}">
            <i class="fas fa-exclamation-triangle me-2"></i>Robos y Hurtos
          </a>
          <a href="{{ url_for('panel', tab='miscelaneo') }}" class="list-group-item list-group-item-action {% if tab=='miscelaneo' %}active{% endif %}">
            <i class="fas fa-tools me-2"></i>Misceláneo
          </a>
          <a href="{{ url_for('panel', tab='desviaciones') }}" class="list-group-item list-group-item-action {% if tab=='desviaciones' %}active{% endif %}">
            <i class="fas fa-random me-2"></i>Desviaciones
          </a>
          <a href="{{ url_for('panel', tab='solicitud_ot') }}" class="list-group-item list-group-item-action {% if tab=='solicitud_ot' %}active{% endif %}">
            <i class="fas fa-clipboard-list me-2"></i>Solicitudes OT
          </a>
          <a href="{{ url_for('panel', tab='reclamos') }}" class="list-group-item list-group-item-action {% if tab=='reclamos' %}active{% endif %}">
            <i class="fas fa-comments me-2"></i>Reclamos
          </a>
          
          <div class="list-group-item fw-bold text-muted small mt-3">MÓDULOS ESPECIALES</div>
          <a href="{{ url_for('panel', tab='alarmas') }}" class="list-group-item list-group-item-action {% if tab=='alarmas' %}active{% endif %}">
            <i class="fas fa-bell me-2"></i>Activación de Alarmas
          </a>
          <a href="{{ url_for('panel', tab='extensiones') }}" class="list-group-item list-group-item-action {% if tab=='extensiones' %}active{% endif %}">
            <i class="fas fa-calendar-plus me-2"></i>Extensiones
          </a>
          <a href="{{ url_for('panel', tab='onboarding') }}" class="list-group-item list-group-item-action {% if tab=='onboarding' %}active{% endif %}">
            <i class="fas fa-user-plus me-2"></i>Onboarding
          </a>
          <a href="{{ url_for('panel', tab='apertura') }}" class="list-group-item list-group-item-action {% if tab=='apertura' %}active{% endif %}">
            <i class="fas fa-door-open me-2"></i>Apertura Habitaciones
          </a>
          <a href="{{ url_for('panel', tab='cumplimiento') }}" class="list-group-item list-group-item-action {% if tab=='cumplimiento' %}active{% endif %}">
            <i class="fas fa-check-circle me-2"></i>Cumplimiento EECC
          </a>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-lg-9">
      <!-- CENSO -->
      {% if tab=='censo' %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-users me-2"></i>Registro de Censo</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap mb-4">
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('template_xlsx', entity='censo') }}">
              <i class="fas fa-download me-1"></i> Descargar Plantilla
            </a>
            <form method="post" action="{{ url_for('import_xlsx', entity='censo') }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
              <input type="file" class="form-control form-control-sm" name="file" accept=".xlsx" required>
              <button class="btn btn-primary-custom btn-sm" type="submit">
                <i class="fas fa-upload me-1"></i> Importar
              </button>
            </form>
          </div>
          
          <form method="post" action="{{ url_for('panel', tab='censo') }}">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required">Fecha</label>
                <input type="date" name="fecha" class="form-control" required>
              </div>
              <div class="col-md-4">
                <label class="form-label">Censo Día</label>
                <input type="number" name="censo_dia" class="form-control" min="0" placeholder="0">
              </div>
              <div class="col-md-4">
                <label class="form-label">Censo Noche</label>
                <input type="number" name="censo_noche" class="form-control" min="0" placeholder="0">
              </div>
              <div class="col-md-4">
                <label class="form-label">Total (opcional)</label>
                <input type="number" name="total" class="form-control" min="0" placeholder="(auto)">
              </div>
            </div>
            <div class="mt-4">
              <button class="btn btn-primary-custom" type="submit">
                <i class="fas fa-save me-1"></i> Guardar Registro
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      <!-- EVENTOS DE SEGURIDAD -->
      {% if tab=='eventos' %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Eventos de Seguridad</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap mb-4">
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('template_xlsx', entity='eventos') }}">
              <i class="fas fa-download me-1"></i> Descargar Plantilla
            </a>
            <form method="post" action="{{ url_for('import_xlsx', entity='eventos') }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
              <input type="file" class="form-control form-control-sm" name="file" accept=".xlsx" required>
              <button class="btn btn-primary-custom btn-sm" type="submit">
                <i class="fas fa-upload me-1"></i> Importar
              </button>
            </form>
          </div>
          
          <form method="post" action="{{ url_for('panel', tab='eventos') }}">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label required">Fecha</label>
                <input type="date" name="fecha" class="form-control" required>
              </div>
              <div class="col-md-3">
                <label class="form-label required">Horario</label>
                <input type="text" name="horario" class="form-control" required placeholder="Mañana/Tarde/Noche o HH:MM">
              </div>
              <div class="col-md-6">
                <label class="form-label">Nombre del Afectado</label>
                <input type="text" name="nombre_afectado" class="form-control">
              </div>
              <div class="col-12">
                <label class="form-label required">Qué Ocurrió</label>
                <textarea name="que_ocurrio" class="form-control" rows="3" required></textarea>
              </div>
              <div class="col-12">
                <label class="form-label">Acción Tomada</label>
                <textarea name="accion" class="form-control" rows="3"></textarea>
              </div>
            </div>
            <div class="mt-4">
              <button class="btn btn-primary-custom" type="submit">
                <i class="fas fa-save me-1"></i> Guardar Evento
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      <!-- DUPLICIDADES -->
      {% if tab=='duplicidades' %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-copy me-2"></i>Registro de Duplicidades</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap mb-4">
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('template_xlsx', entity='duplicidades') }}">
              <i class="fas fa-download me-1"></i> Descargar Plantilla
            </a>
            <form method="post" action="{{ url_for('import_xlsx', entity='duplicidades') }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
              <input type="file" class="form-control form-control-sm" name="file" accept=".xlsx" required>
              <button class="btn btn-primary-custom btn-sm" type="submit">
                <i class="fas fa-upload me-1"></i> Importar
              </button>
            </form>
          </div>
          
          <form method="post" action="{{ url_for('panel', tab='duplicidades') }}">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required">Semana</label>
                <select name="semana" class="form-select" required>
                  <option value="">-- Elegir Semana --</option>
                  {% for num, r in week_map.items()|sort %}
                    <option value="{{ num }}">{{ num }} ({{ r[0] }} → {{ r[1] }})</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label required">Fecha</label>
                <input type="date" name="fecha" class="form-control" required>
              </div>
              <div class="col-md-4">
                <label class="form-label">ID Interno</label>
                <input type="text" name="id" class="form-control">
              </div>

              <div class="col-md-6">
                <label class="form-label">Empresa Contratista</label>
                <input type="text" name="empresa_contratista" class="form-control">
              </div>
              <div class="col-md-6">
                <label class="form-label">Tipo de Riesgo</label>
                <input type="text" name="tipo_riesgo" class="form-control" placeholder="Psicosocial, etc.">
              </div>

              <div class="col-md-4">
                <label class="form-label">Pabellón</label>
                <input type="text" name="pabellon" class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label">Habitación</label>
                <input type="text" name="habitacion" class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label">Contacto</label>
                <input type="text" name="ingresar_contacto" class="form-control">
              </div>

              <div class="col-12">
                <label class="form-label">Descripción del Problema</label>
                <textarea name="descripcion_problema" class="form-control" rows="3"></textarea>
              </div>
              
              <div class="col-md-4">
                <label class="form-label">Responsable</label>
                <input type="text" name="responsable" class="form-control">
              </div>
              <div class="col-md-4">
                <label class="form-label">Estatus</label>
                <select name="estatus" class="form-select">
                  <option value="">-- Seleccionar --</option>
                  <option value="Abierto">Abierto</option>
                  <option value="Cerrado">Cerrado</option>
                  <option value="En Proceso">En Proceso</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Fecha de Cierre</label>
                <input type="date" name="fecha_cierre" class="form-control">
              </div>

              <div class="col-12">
                <label class="form-label">Plan de Acción</label>
                <textarea name="plan_accion" class="form-control" rows="3"></textarea>
              </div>
            </div>
            <div class="mt-4">
              <button class="btn btn-primary-custom" type="submit">
                <i class="fas fa-save me-1"></i> Guardar Duplicidad
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      <!-- ENCUESTAS -->
      {% if tab=='encuesta' %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-poll me-2"></i>Encuesta de Satisfacción</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap mb-4">
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('template_xlsx', entity='encuesta') }}">
              <i class="fas fa-download me-1"></i> Descargar Plantilla
            </a>
            <form method="post" action="{{ url_for('import_xlsx', entity='encuesta') }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
              <input type="file" class="form-control form-control-sm" name="file" accept=".xlsx" required>
              <button class="btn btn-primary-custom btn-sm" type="submit">
                <i class="fas fa-upload me-1"></i> Importar
              </button>
            </form>
          </div>
          
          <form method="post" action="{{ url_for('panel', tab='encuesta') }}">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required">Fecha y Hora</label>
                <input type="datetime-local" name="fecha_hora" class="form-control" required>
              </div>
            </div>

            <div class="row g-3 mt-3">
              {% for i in range(1,6) %}
              <div class="col-md-6">
                <label class="form-label">Pregunta {{i}} - Respuesta</label>
                <input type="text" name="q{{i}}_respuesta" class="form-control" placeholder="Respuesta para pregunta {{i}}">
              </div>
              <div class="col-md-6">
                <label class="form-label">Pregunta {{i}} - Puntaje</label>
                <input type="number" name="q{{i}}_puntaje" class="form-control" min="0" max="10" placeholder="0-10">
              </div>
              {% endfor %}
            </div>

            <div class="mt-4">
              <label class="form-label">Comentarios Adicionales</label>
              <textarea name="comentarios" class="form-control" rows="3"></textarea>
            </div>

            <div class="mt-4">
              <button class="btn btn-primary-custom" type="submit">
                <i class="fas fa-save me-1"></i> Guardar Encuesta
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      <!-- ATENCIÓN AL PÚBLICO -->
      {% if tab=='atencion' %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-headset me-2"></i>Atención al Público</h5>
        </div>
        <div class="card-body">
          <div class="d-flex gap-2 flex-wrap mb-4">
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('template_xlsx', entity='atencion') }}">
              <i class="fas fa-download me-1"></i> Descargar Plantilla
            </a>
            <form method="post" action="{{ url_for('import_xlsx', entity='atencion') }}" enctype="multipart/form-data" class="d-inline-flex gap-2">
              <input type="file" class="form-control form-control-sm" name="file" accept=".xlsx" required>
              <button class="btn btn-primary-custom btn-sm" type="submit">
                <i class="fas fa-upload me-1"></i> Importar
              </button>
            </form>
          </div>
          
          <form method="post" action="{{ url_for('panel', tab='atencion') }}">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label required">Fecha</label>
                <input type="date" name="fecha" class="form-control" required>
              </div>
              <div class="col-md-4">
                <label class="form-label">Tiempo Promedio (mm:ss)</label>
                <input type="text" name="tiempo_promedio" class="form-control" placeholder="mm:ss" pattern="[0-9]{2}:[0-9]{2}" title="mm:ss, ej: 03:54">
              </div>
              <div class="col-md-4">
                <label class="form-label">Cantidad de Atenciones</label>
                <input type="number" name="cantidad" class="form-control" min="0" placeholder="0">
              </div>
            </div>
            <div class="mt-4">
              <button class="btn btn-primary-custom" type="submit">
                <i class="fas fa-save me-1"></i> Guardar Registro
              </button>
            </div>
          </form>
        </div>
      </div>
      {% endif %}

      <!-- MÓDULOS RESTANTES (seguirían con el mismo patrón) -->
      {% if tab not in ['censo', 'eventos', 'duplicidades', 'encuesta', 'atencion'] %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Formulario de {{ tab|replace('_', ' ')|title }}</h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            El formulario para este módulo se cargará aquí. Selecciona una opción del menú lateral para comenzar.
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
