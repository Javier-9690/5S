{% extends "base.html" %}
{% block title %}Editar - {{ title or entity|title }}{% endblock %}

{% block content %}
<div class="content-container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="page-title mb-0">
      <i class="fas fa-pen-to-square me-2"></i>
      Editar {{ title or entity|replace('_', ' ')|title }}
    </h1>
    <a href="{{ back_url or url_for('registros', vista=entity) }}" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-1"></i> Volver a Registros
    </a>
  </div>

  <!-- Mensajes flash (usa los del base.html si llegan) -->

  <div class="card">
    <div class="card-header">
      <div class="d-flex align-items-center justify-content-between">
        <span>Formulario de edici√≥n</span>
        <span class="badge bg-light text-dark">ID: {{ record.id }}</span>
      </div>
    </div>
    <div class="card-body">
      <form method="post" action="{{ url_for('edit_record', entity=entity, rid=record.id) }}">
        <input type="hidden" name="back_url" value="{{ back_url or url_for('registros', vista=entity) }}">

        <div class="row g-3">
          {# fields: name, label, type(text|number|date|time|datetime-local|textarea), required(bool), col(12/6/4), hint #}
          {% for f in fields %}
            {% set val = getattr(record, f.name) %}
            {% set itype = f.type or 'text' %}
            {% set colw = f.col or 6 %}

            {% if itype == 'date' %}
              {% set vstr = (val.isoformat() if val else '') %}
            {% elif itype == 'time' %}
              {% set vstr = (val.strftime('%H:%M') if val else '') %}
            {% elif itype == 'datetime-local' %}
              {% set vstr = (val.strftime('%Y-%m-%dT%H:%M') if val else '') %}
            {% else %}
              {% set vstr = (val if val is not none else '') %}
            {% endif %}

            <div class="col-md-{{ colw }} col-12">
              <label class="form-label {% if f.required %}required{% endif %}">{{ f.label }}</label>

              {% if itype == 'textarea' %}
                <textarea
                  class="form-control"
                  name="{{ f.name }}"
                  rows="3"
                  {% if f.required %}required{% endif %}
                >{{ vstr }}</textarea>
              {% else %}
                <input
                  class="form-control"
                  type="{{ itype }}"
                  name="{{ f.name }}"
                  value="{{ vstr }}"
                  {% if f.required %}required{% endif %}
                >
              {% endif %}

              {% if f.hint %}
                <small class="text-muted d-block mt-1">
                  <i class="fas fa-circle-info me-1"></i>{{ f.hint }}
                </small>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-primary-custom" type="submit">
            <i class="fas fa-save me-1"></i> Guardar cambios
          </button>
          <a href="{{ back_url or url_for('registros', vista=entity) }}" class="btn btn-outline-secondary">
            Cancelar
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

